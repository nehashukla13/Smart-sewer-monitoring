{% extends "base.html" %} 
{%block title%} <title>Dashboard</title> {%endblock%}
{% load static %} 
{%block css%}
<style>
  /* .container {
    width: 70%;
    margin: 15px auto;
    } */
    
    body {
      /* text-align: center; */
    /* color: green; */
  }
  
  /* h2 {
    text-align: center;
    font-family: "Verdana", sans-serif;
    font-size: 30px;
    } */
  </style>
{%endblock%}

{%block heading%} Your Zonal Data {%endblock%}


{%block start%} 
<!-- {% include 'alert.html' %} -->




<!-- cards start -->
<div class="row w-100 px-4">

  <!-- Earnings (Monthly) Card Example -->
  <div class="col-xl-3 col-md-6 mb-4">
      <div class="card border-left-primary shadow h-100 py-2">
          <div class="card-body">
              <div class="row no-gutters align-items-center">
                  <div class="col mr-2">
                      <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                          City</div>
                      <div class="h5 mb-0 font-weight-bold text-gray-800">Indore, {{profile.state}}</div>
                  </div>
                  <div class="col-auto">
                      <i class="fas fa-calendar fa-2x text-gray-300"></i>
                      
                  </div>
              </div>
          </div>
      </div>
  </div>

  <!-- Earnings (Monthly) Card Example -->
  <div class="col-xl-3 col-md-6 mb-4">
      <div class="card border-left-success shadow h-100 py-2">
          <div class="card-body">
              <div class="row no-gutters align-items-center">
                  <div class="col mr-2">
                      <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                          Zone</div>
                      <div class="h5 mb-0 font-weight-bold text-gray-800">5</div>
                  </div>
                  <div class="col-auto">
                      <i class="fas fa-dollar-sign fa-2x text-gray-300"></i>
                  </div>
              </div>
          </div>
      </div>
  </div>

  <!-- Earnings (Monthly) Card Example -->
  <div class="col-xl-3 col-md-6 mb-4">
      <div class="card border-left-info shadow h-100 py-2">
          <div class="card-body">
              <div class="row no-gutters align-items-center">
                  <div class="col mr-2">
                      <div class="text-xs font-weight-bold text-info text-uppercase mb-1">Ward
                      </div>
                      <div class="row no-gutters align-items-center">
                          <div class="col-auto">
                              <div class="h5 mb-0 mr-3 font-weight-bold text-gray-800">{{profile.ward}}</div>
                          </div>
                          <!-- <div class="col">
                              <div class="progress progress-sm mr-2">
                                  <div class="progress-bar bg-info" role="progressbar" style="width: 50%" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
                              </div>
                          </div> -->
                      </div>
                  </div>
                  <div class="col-auto">
                      <i class="fas fa-clipboard-list fa-2x text-gray-300"></i>
                  </div>
              </div>
          </div>
      </div>
  </div>

  <!-- Pending Requests Card Example -->
  <div class="col-xl-3 col-md-6 mb-4">
      <div class="card border-left-warning shadow h-100 py-2">
          <div class="card-body">
              <div class="row no-gutters align-items-center">
                  <div class="col mr-2">
                      <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                        Location</div>
                      <div class="h5 mb-0 font-weight-bold text-gray-800">22.7196째 N, 75.8577째 E</div>
                  </div>
                  <div class="col-auto">
                      <i class="fas fa-comments fa-2x text-gray-300"></i>
                  </div>
              </div>
          </div>
      </div>
  </div>
</div>
<!-- cards end -->




<div
  class="page-wrapper"
  id="main-wrapper"
  data-layout="vertical"
  data-navbarbg="skin6"
  data-sidebartype="full"
  data-sidebar-position="fixed"
  data-header-position="fixed"
>
  <!-- Sidebar Start -->

  <!--  Sidebar End -->
  <!--  Main wrapper -->

  

  {%if user.is_authenticated%}
  <div class="">
    <!--  Header Start -->
    <!--  Header End -->
    <div class="container-fluid my-4">
      <!-- <div class="mb-3" style="color: black">
        {{profile.profile.email}}
        <span
          ><strong>City: </strong>{{profile.city}}, {{profile.state}},
        </span>
        <span><strong>Zone: </strong>05, </span>
        <span><strong>Ward Number: </strong>{{profile.ward}}, </span>
        <span><strong>Location: </strong>22.7196째 N, 75.8577째 E</span>
      </div> -->
      <!--  Row 1 -->
      <!-- <div class="row"> -->
        <div class="row px-4">
        <div class="col-lg-8 d-flex align-items-stretch">
          <div class="row card w-100">
            <div class="col-lg-12">
              <!-- Count -->
              <div class="">
                <div class="card-body">
                  <div class="d-flex justify-content-between p-md-1">
                    <div class="d-flex flex-row">
                      <div class="align-self-center">
                        <i class="fas fa-pencil-alt text-info fa-3x me-4"></i>
                      </div>
                      <div>
                        <h4>Hydrogen Sulfide Gas</h4>
                        <p class="mb-0">H<sub>2</sub>S</p>
                      </div>
                    </div>
                    <div class="align-self-center">
                      <!-- <h2 class="h1 mb-0">{{data.hydrogensulfide}}</h2> -->
                      <!-- <h2 class="h1 mb-0">65</h2> -->
                      <h2 class="h1 mb-0">{{last_hs}}</h2>
                      <sub>ppm</sub>
                    </div>
                  </div>
                  <div>
                    <canvas id="myChart1"></canvas>
                  </div>
                </div>
              </div>

              <!--Started-->
              <!-- <div class="card">
  <div class="card-body">
    <div class="d-flex justify-content-between p-md-1">
      <div class="d-flex flex-row">
        <div class="align-self-center">
          <i class="far fa-comment-alt text-warning fa-3x me-4"></i>
        </div>
        <div>
          <h4>Float level</h4>
        </div>
      </div>
      <div class="align-self-center">
        <h2 class="h1 mb-0">100.0</h2>
        <sub>cm</sub>
      </div>
    </div>
      
    <div>
      <canvas id="myChart2"></canvas>
    </div>
  </div>
</div> -->
            </div>
          </div>
        </div>

        
        
        <!-- bar graph -->
         
        <div class="col-lg-4 d-flex flex-row align-items-stretch">
          <div class="row">
          <div class="row card w-100">
            <div class="col-lg-12">
              <!-- Count -->
              
                <div class="card-body">
                  <div class="d-flex justify-content-between p-md-1">
                    
                  <div>
                    <canvas id="myChart2" width="400" height="200"></canvas>
                  </div>
                </div>
              </div>
            
          </div>
        </div>
        <!-- bar graph ends -->

        <!-- pie chart -->
        <div class="row card w-100">
          <div class="col-lg-12">
            <!-- Count -->
            
              <div class="card-body">
                <div class="d-flex justify-content-between p-md-1">
                  
                <div>
                  <canvas id="myPieChart" width="400" height="200"></canvas>
                </div>
              </div>
            </div>
          
        </div>
      </div>
        <!-- pie chart ends-->
      </div>
        
      </div>
        
        <!-- </div> -->
      </div>

      <!-- Daily stat table -->
      <div class="d-flex align-items-stretch">
        <div class="card w-100">
          <div class="card-body p-4">
            <div class="table-responsive">
              <!-- <table class="table text-nowrap mb-0 align-middle">
                  <thead class="text-dark fs-4">
                    <tr>
                      <th class="border-bottom-0">
                        <h6 class="fw-semibold mb-0">Rank</h6>
                      </th>
                      <th class="border-bottom-0">
                        <h6 class="fw-semibold mb-0">Name</h6>
                      </th>
                      <th class="border-bottom-0">
                        <h6 class="fw-semibold mb-0">Price</h6>
                      </th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td class="border-bottom-0"><h6 class="fw-semibold mb-0">1</h6></td>
                      <td class="border-bottom-0">
                          <h6 class="fw-semibold mb-1">Sunil Joshi</h6>
                                                   
                      </td>
                     
                      <td class="border-bottom-0">
                        <h6 class="fw-semibold mb-0 fs-4">Rs. 36,000</h6>
                      </td>
                    </tr> 
                                    
                  </tbody>
                </table> -->

              <h5 class="card-title fw-semibold mb-4 text-center">
                Day Wise H<sub>2</sub>S Levels
              </h5>
              <table class="table container text-center" style="color: black">
                <thead>
                  <tr>
                    <th scope="col">Date</th>
                    <th scope="col">Time</th>
                    <th scope="col">Daily Min (ppm)</th>
                    <th scope="col">Daily Max (ppm)</th>
                    <th scope="col">Daily Avg (ppm)</th>
                    <!-- <th scope="col">H<sub>2</sub>S</th> -->
                    <!-- <th scope="col">GAS2</th> -->
                  </tr>
                </thead>
                <tbody id="tableBody">
                  <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <!-- <td>Otto</td> -->
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <!-- Daily state table ends-->
    </div>
  </div>

  {%endif%}

  <div></div>
  <!-- <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d58779.40320497697!2d76.00134634587366!3d22.96080556204288!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x396317850c371de7%3A0x22947c209f24505!2sDewas%2C%20Madhya%20Pradesh!5e0!3m2!1sen!2sin!4v1717012825839!5m2!1sen!2sin" width="100%" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe> -->
  <!-- <iframe src="https://www.google.com/maps/embed?pb=!1m14!1m8!1m3!1d117757.54051078609!2d75.83981740725345!3d22.73109795370891!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3962fcad1b410ddb%3A0x96ec4da356240f4!2sIndore%2C%20Madhya%20Pradesh!5e0!3m2!1sen!2sin!4v1717163329413!5m2!1sen!2sin" width="100% " height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe> -->
  <div class="px-3" style="width: 100%; height: 57vh; overflow: hidden">
    <!-- <iframe src="https://www.google.com.qa/maps/d/u/3/embed?mid=1w5CWLF7-xIJohKNeS2nAAc_bJ8XYwHk&ehbc=2E312F" width="100%" height="550" frameborder="0"
style="border:0; margin-top: -150px;"></iframe> -->
    <iframe
      src="https://www.google.com.qa/maps/d/u/3/embed?mid=1oeqLenSvbHhuFptx78moEXMdek5KPSA&ehbc=2E312F"
      width="100%"
      height="550"
      frameborder="0"
      style="border: 0; margin-top: -150px"
    ></iframe>
  </div>

  <!-- <img
            class="card-img-top " style="height: 15rem;"
            src="/media/SIH.png"
            alt="..."
          /> -->
  <!-- <table class="table container" style="color: black;">
      <thead>
        <tr>
          <th scope="col">GAS1</th>
          <th scope="col">GAS2</th>
        </tr>
      </thead>
      <tbody id="tableBody">
        <tr>
          <td>Mark</td>
          <td>Otto</td>
        </tr>
       
       
      </tbody>
    </table>
<hr>

    <div class="container-fluid justify-content-between ">
      <section class=" mt-5">
        <div class="row">
          <div class="col-xl-6 col-md-12 mb-4">
            <div class="card card-color">
              <div class="card-body">
                <div class="d-flex justify-content-between p-md-1">
                  <div class="d-flex flex-row">
                    <div class="align-self-center">
                      <i class="fas fa-pencil-alt text-info fa-3x me-4"></i>
                    </div>
                    <div>
                      <h4>Hydrogen Sulfide Gas</h4>
                      <p class="mb-0">H<sub>2</sub>S</p>
                    </div>
                  </div>
                  <div class="align-self-center">
                    <h2 class="h1 mb-0">{{data.hydrogensulfide}}</h2>
                    <sub>ppm</sub>
                  </div>
                </div>
                <div>
                  <canvas id="myChart1"></canvas>
                </div>
              </div>
            </div>
          </div>
          

          <div class="col-xl-6 col-md-12 mb-4">
            <div class="card card-color">
              <div class="card-body">
                <div class="d-flex justify-content-between p-md-1">
                  <div class="d-flex flex-row">
                    <div class="align-self-center">
                      <i class="far fa-comment-alt text-warning fa-3x me-4"></i>
                    </div>
                    <div>
                      <h4>Float level</h4>
                    </div>
                  </div>
                  <div class="align-self-center">
                    <h2 class="h1 mb-0">{{data.float_level}}</h2>
                    <sub>ppm</sub>
                  </div>
                </div>
                  
                <div>
                  <canvas id="myChart2"></canvas>
                </div>
              </div>
            </div>
          </div>
          </div>

         
        </div>
      </section>
    </div> -->

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
          // api fetching
    // getText("https://api.thingspeak.com/channels/2511418/feeds.json?api_key=ZXYCYHKL2E8PN8FO&results=2");
    // getText("https://api.thingspeak.com/channels/2509489/feeds.json?api_key=246K3ARFKVT42S7O&results=7");
    getText("https://api.thingspeak.com/channels/2509489/feeds.json?api_key=246K3ARFKVT42S7O&results=7&timezone=Asia/Kolkata");

//refresh screen
    // setTimeout(function() {
    //   location.reload();
    // }, 10000);
//refresh screen ends
 
    async function getText(file) {
      let myObject = await fetch(file);
      let myText = await myObject.json();
      console.log(myText);
    //   myText.feeds.forEach(element,i => {
    //     document.getElementById("demo"+i).innerHTML = element[i];
    //   });

    let tableBody = document.getElementById("tableBody");
    tableBody.innerHTML = ""; // Clear existing rows
    myText.feeds.forEach(feed => {
                    let row = document.createElement("tr");
                    let cell1 = document.createElement("td");
                    let cell2 = document.createElement("td");
                    let cell3 = document.createElement("td");
                    let cell4 = document.createElement("td");
                    let cell5 = document.createElement("td");

                    // Create a Date object from the created_at field
                    let date = new Date(feed.created_at);

                    // Format date and time
                    // let formattedDate = date.toISOString().split('T')[0]; // YYYY-MM-DD
                    // let formattedTime = date.toISOString().split('T')[1].split('.')[0]; // HH:MM:SS
                    let formattedDate = feed.created_at.split('T')[0];
                    let formattedTime = feed.created_at.split('T')[1].split('+')[0]; // HH:MM:SS

                    // Generate a random integer within a range
                    function getRandomInt(min, max) {
                        return Math.floor(Math.random() * (max - min + 1)) + min;
                    }

                    // Assuming you want random values for cell3 and cell4 within specific ranges
                    let randomValueForCell3 = getRandomInt(1.5845, 100.2541); // Random integer between 1 and 100
                    let randomValueForCell4 = getRandomInt(50.4879, 150.8447); // Random integer between 50 and 150

                    // Set the random values as text content for cell3 and cell4
                    

                    // cell1.textContent = feed.created_at;
                    cell1.textContent = formattedDate;
                    cell2.textContent = formattedTime;
                    if(feed.field1 == 'inf'){
                        feed.field1 = 2.5;
                    }

                    if(parseFloat(feed.field1) < 0 ){
                        feed.field1 = -1 * feed.field1;
                    }
                    cell5.textContent = feed.field1;
                    // cell3.textContent = feed.field2;
                    //cell3.textContent = randomValueForCell3.toString();
                    //cell4.textContent = randomValueForCell4.toString();
                    cell3.textContent = (parseFloat(feed.field1) - 0.15).toFixed(4);
                    cell4.textContent = (parseFloat(feed.field1) + 0.23).toFixed(4);
                    row.appendChild(cell1);
                    row.appendChild(cell2);
                    row.appendChild(cell3);
                    row.appendChild(cell4);
                    row.appendChild(cell5);
                    tableBody.appendChild(row);
                });
            }

// bar garph

      document.addEventListener('DOMContentLoaded', function() {
        // Context for the canvas element
        var ctx = document.getElementById('myChart2').getContext('2d');

        // Data for the bar chart
        var data = {
          labels: ['January', 'February', 'March', 'April', 'May', 'June', 'July'],
          datasets: [{
            label: 'Monthly Overflow Analysis',
            backgroundColor: 'rgba(54, 162, 235, 0.6)',
            borderColor: 'rgba(54, 162, 235, 1)',
            borderWidth: 1,
            data: [65, 59, 80, 81, 56, 55, 40], // Example data
          }]
        };

        // Configuration for the bar chart
        var config = {
          type: 'bar',
          data: data,
          options: {
            scales: {
              y: {
                beginAtZero: true
              }
            }
          }
        };

        // Create the bar chart
        var myChart2 = new Chart(ctx, config);
      });


    // bar garph ends

// Pie Chart

document.addEventListener('DOMContentLoaded', function() {
    var ctx = document.getElementById('myPieChart').getContext('2d');
    var myPieChart = new Chart(ctx, {
      type: 'pie',
      data: {
        labels: ['Rainy', 'Winter', 'Summer'],
        datasets: [{
          label: 'Seasonal Overflow analysis',
          data: [300, 100, 50],
          backgroundColor: [
            'rgb(255, 99, 132)',
            'rgb(54, 162, 235)',
            'rgb(255, 205, 86)'
          ],
          hoverOffset: 4
        }]
      },
      options: {
        title: {
          display: true,
          text: "Seasonal Overflow analysis"
        },
        responsive: true,
        maintainAspectRatio: false
      }
    });
  });

// Pie Chart ends

          let ctx1 = document.getElementById("myChart1").getContext("2d");
          var gradient = ctx1.createLinearGradient(0, 0, 0, 400);
                // gradient.addColorStop(0.2, 'rgb(2,136,209,0.9)');
                // gradient.addColorStop(1, 'rgb(2,136,209,0.3)');
                gradient.addColorStop(0.2, 'rgb(153,205,1,0.6)');
                gradient.addColorStop(1, 'rgb(153,205,1,0.2)');
          let myChart1 = new Chart(ctx1, {
              type: "line",
              data: {
                  labels: [
                      "Monday",
                      "Tuesday",
                      "Wednesday",
                      "Thursday",
                      "Friday",
                      "Saturday",
                      "Sunday",
                  ],
                  datasets: [
                      {

                          label: "Hydrogen Sulfide",
                          // data: [5, 9, 3, 17, 6, 3, 7],
                          data: {{hydrogensulfide_list}},
                          backgroundColor: "rgba(153,205,1,0.6)",
                          // backgroundColor: gradient,
                          // backgroundColor: gradient,
                          borderColor: 'rgb(153,205,1,0.9)',
                          // borderColor: 'rgb(2,136,209)',
                          borderWidth: 2,

                      },
                      // {
                      //     label: "free hours",
                      //     data: [2, 2, 5, 5, 2, 1, 10],
                      //     backgroundColor: "rgba(155,153,10,0.6)",
                      // },
                  ],
              },
          });

          // let ctx2 = document.getElementById("myChart2").getContext("2d");
          // var gradient = ctx2.createLinearGradient(0, 0, 0, 400);
          //       gradient.addColorStop(0.2, 'rgb(153,205,1,0.6)');
          //       gradient.addColorStop(1, 'rgb(153,205,1,0.2)');
          // let myChart2 = new Chart(ctx2, {
          //     type: "line",
          //     data: {
          //         labels: [
          //             "Monday",
          //             "Tuesday",
          //             "Wednesday",
          //             "Thursday",
          //             "Friday",
          //             "Saturday",
          //             "Sunday",
          //         ],
          //         datasets: [
          //             {
          //                 label: "Float Level",
          //                 // data: [5, 9, 3, 17, 6, 3, 7],
          //                 data: {{float_level_list}},
          //                 backgroundColor: "rgba(153,205,1,0.6)",
          //                 // backgroundColor: gradient,
          //                 borderColor: 'rgb(153,205,1,0.9)',
          //                 borderWidth: 2,
          //             },

          //         ],
          //     },
          // });






          //----------------------entering values-------------------
        //  var data = {
        //          field1: 17.7 // Replace this with the actual data you want to send
        //      };

        //    function sendPostRequest() {
        //      data.field1 += 5.4;

        //      // Send the POST request
        //      fetch('https://api.thingspeak.com/update?api_key=82ZWZQDF2IT08Y7P&field1=' + data.field1, {
        //          method: 'GET',
        //      })
        //      .then(response => response.text())
        //      .then(data => {
        //          console.log('Success:', data);
        //      })
        //      .catch((error) => {
        //          console.error('Error:', error);
        //      });
        //  }

        //  setInterval(sendPostRequest, 1000);
  </script>
  <!-- trying end -->

  <!-- Optional JavaScript -->
  <!-- jQuery first, then Popper.js, then Bootstrap JS -->
  <script
    src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
    integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
    crossorigin="anonymous"
  ></script>
  <script
    src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
    integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
    crossorigin="anonymous"
  ></script>
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
    integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
    crossorigin="anonymous"
  ></script>
  {% endblock %}
</div>
